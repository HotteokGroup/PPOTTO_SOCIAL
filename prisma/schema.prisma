// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// 공유앨범
model ShareAlbum {
  id                   String                 @id @default(cuid())
  name                 String
  bio                  String?
  thumbnailIId         String?
  smallThumbnailIUrl   String?
  mediumThumbnailIUrl  String?
  largeThumbnailIUrl   String?
  deletedAt            DateTime?
  updatedAt            DateTime               @updatedAt
  createdAt            DateTime               @default(now())
  // Relation
  // ShareAlbum --< ShareAlbumMember
  shareAlbumMember     ShareAlbumMember[]
  // ShareAlbum --< ShareAlbumHistory
  shareAlbumHistory    ShareAlbumHistory[]
  // ShareAlbum --< ShareAlbumInviteCode
  shareAlbumInviteCode ShareAlbumInviteCode[]

  //Index
  @@index([id], name: "ShareAlbum_id")
}

/// 공유앨범 멤버
model ShareAlbumMember {
  id           String               @id @default(cuid())
  shareAlbumId String
  userId       Int
  role         ShareAlbumMemberRole
  joinedAt     DateTime?
  deletedAt    DateTime?
  updatedAt    DateTime             @updatedAt
  createdAt    DateTime             @default(now())
  // Relation
  //  ShareAlbumMember >-- ShareAlbum
  shareAlbum   ShareAlbum           @relation(fields: [shareAlbumId], references: [id])

  //Index
  @@index([id], name: "ShareAlbumMember_id")
  @@index([userId], name: "ShareAlbumMember_userId")
  @@index([shareAlbumId, userId], name: "ShareAlbumMember_shareAlbumId_userId")
}

/// 공유앨범 멤버 권한
enum ShareAlbumMemberRole {
  OWNER
  EDITOR
  VIEWER
  TEMPORARY
}

/// 공유앨범 히스토리
model ShareAlbumHistory {
  id           String                @id @default(cuid())
  type         ShareAlbumHistoryType
  shareAlbumId String
  contentId    String?
  userId       Int?
  description  String?
  createdAt    DateTime              @default(now())
  // Relation
  // ShareAlbumHistory >-- ShareAlbum
  shareAlbum   ShareAlbum            @relation(fields: [shareAlbumId], references: [id])

  // Index
  @@index([id], name: "ShareAlbumHistory_id")
  @@index([shareAlbumId], name: "ShareAlbumHistory_shareAlbumId")
}

/// 공유앨범 히스토리 타입
enum ShareAlbumHistoryType {
  // 공유앨범 히스토리
  /// 공유앨범 생성
  CREATE_SHARE_ALBUM
  /// 공유앨범 수정
  UPDATE_SHARE_ALBUM
  /// 공유앨범 삭제
  DELETE_SHARE_ALBUM
  // 공유앨범 멤버 히스토리
  /// 공유앨범 초대
  INVITE_SHARE_ALBUM
  /// 공유앨범 가입
  JOIN_SHARE_ALBUM
  /// 공유앨범 탈퇴
  LEAVE_SHARE_ALBUM
}

/// 공유앨범 초대코드
model ShareAlbumInviteCode {
  id           String     @id @default(cuid())
  shareAlbumId String
  code         String
  deletedAt    DateTime?
  updatedAt    DateTime   @updatedAt
  createdAt    DateTime   @default(now())
  // Relation
  // ShareAlbumInviteCode >-- ShareAlbum
  shareAlbum   ShareAlbum @relation(fields: [shareAlbumId], references: [id])

  // Index
  @@index([id], name: "ShareAlbumInviteCode_id")
  @@index([code], name: "ShareAlbumInviteCode_code")
}
